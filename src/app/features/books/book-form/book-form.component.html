<div class="form-container">
  <!-- Header -->
  <div class="form-header">
    <h1>ğŸ“š Yeni Kitap Ekle</h1>
    <p class="subtitle">KÃ¼tÃ¼phaneye yeni kitap eklemek iÃ§in formu doldurun</p>
  </div>

  <!-- Loading Data - ngIf kullanÄ±mÄ± -->
  <div *ngIf="!isDataLoaded" class="loading-section">
    <div class="loading-spinner">ğŸ”„</div>
    <p>Veriler yÃ¼kleniyor...</p>
    
    <!-- DetaylÄ± loading states - ngIf -->
    <div class="loading-details">
      <div *ngIf="authorsLoading" class="loading-item">
        ğŸ“ Yazarlar yÃ¼kleniyor...
      </div>
      <div *ngIf="categoriesLoading" class="loading-item">
        ğŸ“‚ Kategoriler yÃ¼kleniyor...
      </div>
    </div>
  </div>

  <!-- Main Form - ngIf ile koÅŸullu gÃ¶sterim -->
  <div *ngIf="isDataLoaded" class="form-content">
    
    <!-- Success Message - ngIf -->
    <div *ngIf="successMessage" class="alert success-alert">
      <span class="alert-icon">âœ…</span>
      <span class="alert-text">{{ successMessage }}</span>
    </div>

    <!-- Error Message - ngIf -->
    <div *ngIf="errorMessage" class="alert error-alert">
      <span class="alert-icon">âŒ</span>
      <span class="alert-text">{{ errorMessage }}</span>
    </div>

    <!-- Book Form -->
    <form (ngSubmit)="onSubmit()" #bookForm="ngForm" class="book-form">
      
      <!-- Kitap AdÄ± -->
      <div class="form-group">
        <label for="title">Kitap AdÄ± *</label>
        <input 
          id="title"
          type="text"
          [(ngModel)]="book.title"
          name="title"
          placeholder="Kitap adÄ±nÄ± girin"
          class="form-control"
          required
          #titleInput="ngModel">
        
        <!-- Field Error - ngIf ile validation -->
        <div *ngIf="titleInput.invalid && titleInput.touched" class="field-error">
          <span class="error-icon">âš ï¸</span>
          Kitap adÄ± gereklidir
        </div>
      </div>

      <!-- AÃ§Ä±klama -->
      <div class="form-group">
        <label for="description">AÃ§Ä±klama</label>
        <textarea 
          id="description"
          [(ngModel)]="book.description"
          name="description"
          placeholder="Kitap hakkÄ±nda kÄ±sa aÃ§Ä±klama (opsiyonel)"
          class="form-control textarea"
          rows="3"></textarea>
      </div>

      <!-- Sayfa SayÄ±sÄ± -->
      <div class="form-group">
        <label for="pages">Sayfa SayÄ±sÄ± *</label>
        <input 
          id="pages"
          type="number"
          [(ngModel)]="book.countofPage"
          name="pages"
          placeholder="Sayfa sayÄ±sÄ±nÄ± girin"
          class="form-control"
          min="1"
          required
          #pagesInput="ngModel">
        
        <!-- Field Error - ngIf ile validation -->
        <div *ngIf="pagesInput.invalid && pagesInput.touched" class="field-error">
          <span class="error-icon">âš ï¸</span>
          <span *ngIf="book.countofPage <= 0">Sayfa sayÄ±sÄ± 0'dan bÃ¼yÃ¼k olmalÄ±dÄ±r</span>
          <span *ngIf="book.countofPage == null">Sayfa sayÄ±sÄ± gereklidir</span>
        </div>
      </div>

      <!-- Yazar SeÃ§imi - ngFor kullanÄ±mÄ± -->
      <div class="form-group">
        <label for="author">Yazar *</label>
        <select 
          id="author"
          [(ngModel)]="book.authorId"
          name="author"
          class="form-control"
          required
          #authorInput="ngModel">
          
          <option value="0" disabled>Yazar seÃ§in</option>
          
          <!-- ngFor ile yazarlarÄ± listele -->
          <option *ngFor="let author of authors; let i = index" 
                  [value]="author.id">
            {{ i + 1 }}. {{ author.name }} {{ author.surname }} 
            ({{ author.yearofBirth }})
          </option>
        </select>
        
        <!-- Field Error - ngIf ile validation -->
        <div *ngIf="authorInput.invalid && authorInput.touched" class="field-error">
          <span class="error-icon">âš ï¸</span>
          Yazar seÃ§imi gereklidir
        </div>

        <!-- Authors Count Info - ngIf -->
        <div *ngIf="authors.length > 0" class="info-text">
          Toplam {{ authors.length }} yazar mevcut
        </div>
      </div>

      <!-- Kategori SeÃ§imi - ngFor kullanÄ±mÄ± -->
      <div class="form-group">
        <label for="category">Kategori *</label>
        <select 
          id="category"
          [(ngModel)]="book.categoryId"
          name="category"
          class="form-control"
          required
          #categoryInput="ngModel">
          
          <option value="0" disabled>Kategori seÃ§in</option>
          
          <!-- ngFor ile kategorileri listele -->
          <option *ngFor="let category of categories; trackBy: trackByCategory" 
                  [value]="category.id">
            {{ category.name }}
          </option>
        </select>
        
        <!-- Field Error - ngIf ile validation -->
        <div *ngIf="categoryInput.invalid && categoryInput.touched" class="field-error">
          <span class="error-icon">âš ï¸</span>
          Kategori seÃ§imi gereklidir
        </div>

        <!-- Categories List Preview - ngFor ile preview -->
        <div class="categories-preview">
          <span class="preview-label">Mevcut kategoriler:</span>
          <span *ngFor="let category of categories; let last = last"
                class="category-tag">
            {{ category.name }}<span *ngIf="!last">, </span>
          </span>
        </div>
      </div>

      <!-- Form Debug Info - ngIf (sadece development iÃ§in) -->
      <div *ngIf="true" class="debug-section">
        <h4>ğŸ” Form Debug Bilgileri</h4>
        <div class="debug-item">
          <strong>Form Valid:</strong> 
          <span [class]="isFormValid() ? 'valid' : 'invalid'">
            {{ isFormValid() ? 'âœ… GeÃ§erli' : 'âŒ GeÃ§ersiz' }}
          </span>
        </div>
        <div class="debug-item">
          <strong>SeÃ§ilen Yazar ID:</strong> {{ book.authorId || 'SeÃ§ilmedi' }}
        </div>
        <div class="debug-item">
          <strong>SeÃ§ilen Kategori ID:</strong> {{ book.categoryId || 'SeÃ§ilmedi' }}
        </div>
        <div class="debug-item">
          <strong>Girilen Veriler:</strong>
          <pre>{{ book | json }}</pre>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button 
          type="submit"
          [disabled]="isSubmitting || !isFormValid()"
          class="btn btn-primary">
          
          <!-- Loading state - ngIf -->
          <span *ngIf="isSubmitting" class="btn-loading">
            ğŸ”„ Kaydediliyor...
          </span>
          <span *ngIf="!isSubmitting">
            ğŸ’¾ KitabÄ± Kaydet
          </span>
        </button>

        <button 
          type="button"
          (click)="clearForm()"
          [disabled]="isSubmitting"
          class="btn btn-secondary">
          ğŸ—‘ï¸ Formu Temizle
        </button>

        <button 
          type="button"
          (click)="goBack()"
          class="btn btn-outline">
          â† Geri DÃ¶n
        </button>
      </div>
    </form>
  </div>

  <!-- Authors & Categories Summary - ngFor ve ngIf kullanÄ±mÄ± -->
  <div *ngIf="isDataLoaded" class="summary-section">
    <div class="summary-grid">
      
      <!-- Authors Summary -->
      <div class="summary-card">
        <h3>ğŸ‘¥ Yazarlar ({{ authors.length }})</h3>
        <div class="summary-list">
          <div *ngFor="let author of authors.slice(0, 3); let first = first; let last = last"
               class="summary-item"
               [class.highlight]="book.authorId === author.id">
            <span class="author-name">{{ author.name }} {{ author.surname }}</span>
            <span class="author-year">({{ author.yearofBirth }})</span>
          </div>
          
          <!-- More authors indicator - ngIf -->
          <div *ngIf="authors.length > 3" class="summary-more">
            ... ve {{ authors.length - 3 }} yazar daha
          </div>
        </div>
      </div>

      <!-- Categories Summary -->
      <div class="summary-card">
        <h3>ğŸ“‚ Kategoriler ({{ categories.length }})</h3>
        <div class="summary-list">
          <div *ngFor="let category of categories"
               class="summary-item category-item"
               [class.highlight]="book.categoryId === category.id">
            {{ category.name }}
          </div>
        </div>
      </div>
    </div>
  </div>
</div> 