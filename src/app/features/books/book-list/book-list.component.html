<!-- book-list.component.html - Updated with Popup Modal -->
<div class="book-list-container" (keydown)="onKeyDown($event)" tabindex="0">
  <!-- Header -->
  <div class="header">
    <h1>ğŸ“š Kitap YÃ¶netimi</h1>
    <div class="header-actions">
      <button *ngIf="authService.canCreate()" (click)="addNewBook()" class="btn-primary">
        â• Yeni Kitap Ekle
      </button>
      <button (click)="searchBooks()" class="btn-thirty">
        ğŸ” Kitap Ara
      </button>
      <button (click)="goBack()" class="btn-secondary">
        â† Dashboard'a DÃ¶n
      </button>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading">
    <div class="spinner"></div>
    <p>Kitaplar yÃ¼kleniyor...</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="error-message">
    âŒ {{ errorMessage }}
    <button (click)="loadBooks()" class="retry-btn">ğŸ”„ Tekrar Dene</button>
  </div>

  <!-- Books List -->
  <div *ngIf="!isLoading && !errorMessage" class="books-section">
    
    <!-- Books Count -->
    <div class="books-count">
      <p>Toplam <strong>{{ books.length }}</strong> kitap bulundu</p>
    </div>

    <!-- No Books -->
    <div *ngIf="books.length === 0" class="no-books">
      <div class="no-books-icon">ğŸ“­</div>
      <h3>HenÃ¼z kitap eklenmemiÅŸ</h3>
      <p>Ä°lk kitabÄ±nÄ±zÄ± eklemek iÃ§in "Yeni Kitap Ekle" butonunu kullanÄ±n.</p>
      <button (click)="addNewBook()" class="btn-primary">
        â• Ä°lk KitabÄ± Ekle
      </button>
    </div>

    <!-- Books Grid -->
    <div *ngIf="books.length > 0" class="books-grid">
      <div *ngFor="let book of books; let i = index" 
           class="book-card clickable" 
           (click)="openBookModal(book)">
        
        <!-- Book Number -->
        <div class="book-number">{{ i + 1 }}</div>
        
        <!-- Book Info -->
        <div class="book-info">
          
          <!-- Book Image -->
          <div class="book-image">
            <img *ngIf="book.fileKey; else noImage" 
                 [src]="book.fileKey" 
                 [alt]="book.title" 
                 width="250" />
            <ng-template #noImage>
              <div class="no-image">ğŸ“· Resim Yok</div>
            </ng-template>
          </div>
          
          <h3 class="book-title">{{ book.title }}</h3>
          
          <!-- ğŸ†• Stok bilgisi kartlarda da gÃ¶sterilsin -->
          <div class="book-stock-info">
            <span class="stock-mini-badge" 
                  [class.available]="book.availableCopies > 0"
                  [class.unavailable]="book.availableCopies === 0">
              ğŸ“¦ {{ book.availableCopies }}/{{ book.totalCopies }}
            </span>
          </div>
        </div>
    
        <!-- Book Actions -->
        <div class="book-actions" (click)="$event.stopPropagation()">
          <button *ngIf="authService.canEdit()" 
                  (click)="editBook(book.id)" 
                  class="action-btn edit-btn">
            âœï¸ DÃ¼zenle
          </button>
          <button *ngIf="authService.canDelete()"
                  (click)="deleteBook(book.id)" 
                  class="action-btn delete-btn">
            ğŸ—‘ï¸ Sil
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ğŸ†• BOOK DETAIL MODAL -->
  <div *ngIf="showModal" 
       class="modal-overlay" 
       (click)="onBackdropClick($event)">
    
    <div class="modal-content" (click)="$event.stopPropagation()">
      
      <!-- Modal Header -->
      <div class="modal-header">
        <h2>ğŸ“š Kitap DetaylarÄ±</h2>
        <button class="close-btn" (click)="closeBookModal()">
          âŒ
        </button>
      </div>

      <!-- Modal Body -->
      <div class="modal-body" *ngIf="selectedBook">
        
        <!-- Book Content Layout -->
        <div class="book-content">
          
          <!-- Left Side: Book Image -->
          <div class="book-image-section">
            <div class="modal-book-image">
              <img *ngIf="selectedBook.fileKey; else noModalImage" 
                   [src]="selectedBook.fileKey" 
                   [alt]="selectedBook.title" />
              <ng-template #noModalImage>
                <div class="no-modal-image">
                  ğŸ“·
                  <span>Resim Yok</span>
                </div>
              </ng-template>
            </div>
          </div>

          <!-- Right Side: Book Details -->
          <div class="book-details-section">
            
            <!-- Book Title -->
            <h3 class="modal-book-title">
              ğŸ“– {{ selectedBook.title }}
            </h3>

            <!-- Author Info -->
            <div class="detail-row">
              <span class="detail-icon">âœï¸</span>
              <span class="detail-label">Yazar:</span>
              <span class="detail-value">{{ getAuthorFullInfo() }}</span>
            </div>

            <!-- Category Info -->
            <div class="detail-row">
              <span class="detail-icon">ğŸ·ï¸</span>
              <span class="detail-label">Kategori:</span>
              <span class="detail-value">
                {{ selectedCategory?.name || 'Kategori bulunamadÄ±' }}
              </span>
            </div>

            <!-- Page Count -->
            <div class="detail-row">
              <span class="detail-icon">ğŸ“„</span>
              <span class="detail-label">Sayfa SayÄ±sÄ±:</span>
              <span class="detail-value">{{ selectedBook.countofPage }} sayfa</span>
            </div>  
          </div>
        </div>

        <!-- Description Section -->
        <div class="description-section" *ngIf="selectedBook.description">
          <h4>ğŸ“ Kitap Ã–zeti:</h4>
          <p class="book-description-full">{{ selectedBook.description }}</p>
        </div>

      </div>

      <!-- Modal Footer -->
      <div class="modal-footer">
        
        <!-- ğŸ†• STOK BÄ°LGÄ°SÄ° -->
        <div class="stock-info">
          <span class="stock-badge" 
                [class.available]="getAvailableCopies(selectedBook?.id || 0) > 0"
                [class.unavailable]="getAvailableCopies(selectedBook?.id || 0) === 0">
            ğŸ“¦ {{ getAvailableCopies(selectedBook?.id || 0) }}/{{ getTotalCopies(selectedBook?.id || 0) }} Mevcut
          </span>
        </div>

        <!-- ğŸ†• Ã–DÃœNÃ‡ AL BUTONU -->
        <button 
          *ngIf="!isBookBorrowed(selectedBook?.id || 0) && getAvailableCopies(selectedBook?.id || 0) > 0"
          (click)="borrowBook(selectedBook!)" 
          class="modal-btn borrow-btn"
          [disabled]="isBorrowing">
          <span *ngIf="!isBorrowing">ğŸ“š Ã–dÃ¼nÃ§ Al</span>
          <span *ngIf="isBorrowing">â³ Ã–dÃ¼nÃ§ AlÄ±nÄ±yor...</span>
        </button>

        <!-- ğŸ†• ZATEN Ã–DÃœNÃ‡ ALINMIÅ MESAJI -->
        <div *ngIf="isBookBorrowed(selectedBook?.id || 0)" class="already-borrowed">
          âœ… Bu kitabÄ± zaten Ã¶dÃ¼nÃ§ almÄ±ÅŸsÄ±nÄ±z
        </div>

        <!-- ğŸ†• STOKTÄ° MESAJI -->
        <div *ngIf="getAvailableCopies(selectedBook?.id || 0) === 0" class="out-of-stock">
          âŒ Bu kitap ÅŸu anda mevcut deÄŸil
        </div>  
      </div>
    </div>
  </div>
</div>